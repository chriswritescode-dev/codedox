services:
  codedox:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: codedox
    ports:
      - "0.0.0.0:8002:8002"
    environment:
      # Database (your existing PostgreSQL)
      DB_HOST: 192.168.1.244
      DB_PORT: 5432
      DB_NAME: codedocs
      DB_USER: mcp
      DB_PASSWORD: mcp!#!%rag
      
      # API Server
      API_HOST: 0.0.0.0
      API_PORT: 8002
      
      # LLM Service
      CODE_ENABLE_LLM_EXTRACTION: "true"
      CODE_LLM_API_KEY: test-key
      CODE_LLM_PROVIDER: openai
      CODE_LLM_EXTRACTION_MODEL: GLM-4.5-Air
      CODE_LLM_BASE_URL: http://192.168.1.243:8000/v1
      CODE_LLM_NUM_PARALLEL: "30"
      CODE_DISABLE_FORMATING: "true"

      # Crawling
      CRAWL_MAX_CONCURRENT_SESSIONS: "5"
      
      # Environment
      ENVIRONMENT: production
      LOG_LEVEL: INFO
      LOG_FILE: logs/codedox.log
      
      # CORS
      API_CORS_ORIGINS: "http://localhost:8002,http://192.168.1.244:8002,http://192.168.1.244:5173,http://localhost:5173,http://0.0.0.0:8002"
      
    volumes:
      - logs_data:/app/logs
      - ./config.runtime.json:/app/config.runtime.json:ro
    restart: unless-stopped

volumes:
  logs_data:

networks:
  default:
    name: codedox-single
